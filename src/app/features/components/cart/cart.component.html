<div class="cart-page-container">
  <h2>Alƒ±≈üveri≈ü Sepetim</h2>

  <ng-container *ngIf="cart$ | async as cart; else loadingOrError">

    <div *ngIf="!cart || cart.items.length === 0; else cartContent" class="empty-cart">
      <p>Alƒ±≈üveri≈ü sepetiniz bo≈ü.</p>
      <a routerLink="/products">Alƒ±≈üveri≈üe Ba≈üla</a>
    </div>

    <ng-template #cartContent>
      <div class="cart-layout">

        <div class="cart-items">
          <table>
            <thead>
              <tr>
                <th colspan="2">√úr√ºn</th>
                <th>Fiyat</th>
                <th>Miktar</th>
                <th>Toplam</th>
                <th></th> </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of cart.items" class="cart-item">
                <td class="item-image">
                  <img [src]="item.product.imageUrl || 'https://via.placeholder.com/60?text=Resim'"
                       [alt]="item.product.name"> </td>
                <td class="item-name">
                  <a [routerLink]="['/products/detail', item.productId]">{{ item.product.name }}</a>
                </td>
                <td class="item-price">
                  {{ item.unitPrice | currency:'TRY':'symbol':'1.2-2' }}
                </td>
                <td class="item-quantity">
                  <div class="quantity-control">
                    <button type="button" (click)="decrementQuantity(item)" aria-label="Azalt">-</button>
                    <input
                      type="number"
                      min="0"
                      [value]="item.quantity"
                      (change)="updateQuantityFromInput(item, $event)" aria-label="Miktar">
                     <button type="button" (click)="incrementQuantity(item)" aria-label="Artƒ±r">+</button>
                  </div>
                </td>
                <td class="item-total-price">
                  {{ item.totalPrice | currency:'TRY':'symbol':'1.2-2' }}
                </td>
                <td class="item-remove">
                   <button (click)="removeFromCart(item)" title="√úr√ºn√º Kaldƒ±r" aria-label="√úr√ºn√º Kaldƒ±r">
                    <i class="icon-trash">üóëÔ∏è</i> </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="cart-summary">
           <h4>Sipari≈ü √ñzeti</h4>
            <div class="summary-row">
                <span>√úr√ºnler Toplamƒ± ({{ cart.totalItems }} √ºr√ºn)</span>
                <span>{{ cart.totalPrice | currency:'TRY':'symbol':'1.2-2' }}</span>
            </div>
            <div class="summary-row total">
                <span>Toplam Tutar</span>
                <span>{{ cart.totalPrice | currency:'TRY':'symbol':'1.2-2' }}</span>
            </div>
            <div class="cart-actions">
                <button class="clear-cart-btn" (click)="clearCart()">Sepeti Bo≈üalt</button>
                <button class="checkout-btn" routerLink="/checkout">Alƒ±≈üveri≈üi Tamamla</button>
            </div>
        </div>

      </div> </ng-template>

  </ng-container>

  <ng-template #loadingOrError>
    <p>Sepet y√ºkleniyor veya bir hata olu≈ütu...</p>
    </ng-template>

</div>
